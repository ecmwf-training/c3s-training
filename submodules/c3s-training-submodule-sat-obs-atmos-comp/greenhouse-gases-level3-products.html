
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>How to access, read and use satellite XCO2 and XCH4 Level 3 data products &#8212; Copernicus Climate Change Service (C3S) Training Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'submodules/c3s-training-submodule-sat-obs-atmos-comp/greenhouse-gases-level3-products';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Exploring gridded data on Aerosol properties available on C3S" href="aerosol-single-sensor-demonstrator.html" />
    <link rel="prev" title="How to access and use a satellite-derived GHG Level 2 data product using XCO2_EMMA as an example?" href="greenhouse-gases-level2-products.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">⚠️This is a TEST Version, this is not an official website⚠️</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Copernicus Climate Change Service (C3S) Training Book</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Copernicus Climate Change Service (C3S) Data Tutorials
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../how-to-run-these-tutorials.html">How to run these tutorials</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../c3s-training-submodule-reanalysis/intro.html">Reanalysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../c3s-training-submodule-reanalysis/reanalysis-climatology.html">Climatology</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c3s-training-submodule-reanalysis/reanalysis-heatwave.html">Heatwave Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c3s-training-submodule-reanalysis/reanalysis-temp-record.html">Temperature Record</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../c3s-training-submodule-projections/intro.html">Climate Projections</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../c3s-training-submodule-projections/projections-cmip6.html">Global Climate Projections (CMIP6)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c3s-training-submodule-projections/projections-cordex.html">Regional Climate Projections (CORDEX)</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../c3s-training-submodule-seasonal-forecast/intro.html">Seasonal Forecasts</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../c3s-training-submodule-seasonal-forecast/sf-anomalies.html">Seasonal Forecast Anomalies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c3s-training-submodule-seasonal-forecast/sf-verification.html">Seasonal Forecast Verification</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../c3s-training-submodule-climate-indices/intro.html">Climate Indices</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../c3s-training-submodule-climate-indices/ci-windchill.html">Windchill</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../c3s-training-submodule-sat-obs-atmos-physics/intro.html">Satellite Observations - Atmospheric Physic</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../c3s-training-submodule-sat-obs-atmos-physics/erb-outgoing-longwave-radiation.html">Outgoing Longwave Radiation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c3s-training-submodule-sat-obs-atmos-physics/erb-clara-climatology.html">Analysis of the CLARA Earth radiation budget product</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c3s-training-submodule-sat-obs-atmos-physics/erb-ceres-climatology.html">Analysis of the CERES Earth radiation budget product</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c3s-training-submodule-sat-obs-atmos-physics/total-solar-irradiance.html">Total Solar Irradiance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c3s-training-submodule-sat-obs-atmos-physics/srb-climatology-and-anomaly.html">Surface radiation budget climatologies and anomalies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c3s-training-submodule-sat-obs-atmos-physics/total-column-water-vapour-combi.html">Total column water vapour</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c3s-training-submodule-sat-obs-atmos-physics/tropospheric-humidity-from-radio-occultation.html">Tropospheric humidity estimates from satellite-based radio occultation measurements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c3s-training-submodule-sat-obs-atmos-physics/cloud-cover-climatology.html">Cloud fractional cover climatology</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c3s-training-submodule-sat-obs-atmos-physics/precipitation-giraffe.html">Exploring Precipitation information in the GIRAFFE dataset</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="intro.html">Satellite Observations - Atmospheric Composition</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="greenhouse-gases-level2-products.html">How to access and use a satellite-derived GHG Level 2 data product using XCO2_EMMA as an example?</a></li>


<li class="toctree-l2 current active"><a class="current reference internal" href="#">How to access, read and use satellite XCO2 and XCH4 Level 3 data products</a></li>


<li class="toctree-l2"><a class="reference internal" href="aerosol-single-sensor-demonstrator.html">Exploring gridded data on Aerosol properties available on C3S</a></li>








<li class="toctree-l2"><a class="reference internal" href="aerosol-multi-sensor-record.html">Visualising a full Climate Data Record of multi-sensor Aerosol data</a></li>









<li class="toctree-l2"><a class="reference internal" href="total-ozone-columns.html">Total Ozone Columns</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../c3s-training-submodule-sat-obs-hydro-cryo/intro.html">Satellite Observations - Hydrology and Cryosphere</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../c3s-training-submodule-sat-obs-hydro-cryo/soil-moisture-anomalies.html">Soil Moisture Anomaly Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c3s-training-submodule-sat-obs-hydro-cryo/lake-surface-water-temperature.html">Lake Surface Water Temperature Analysis</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../c3s-training-submodule-sat-obs-land/intro.html">Satellite Observations - Land</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Explore other books📚</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://Randbee.github.io/CAMSBook">Copernicus Atmosphere Monitoring Service (CAMS) Data Tutorials</a></li>
<li class="toctree-l1"><a class="reference external" href="https://ecmwfcode4earth.github.io/sketchbook-earth">Sketchbook Earth - A collection of Jupyter notebooks for Earth Sciences</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">ECMWF</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../support.html">Help&amp;Support</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://climate.copernicus.eu/">Copernicus Climate Change Service (C3S)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cds.climate.copernicus.eu/">Copernicus Climate Data Store (CDS)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://climate.copernicus.eu/user-learning-services/">C3S Training Services</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/Randbee/C3SBook/review?urlpath=tree/submodules/c3s-training-submodule-sat-obs-atmos-comp/greenhouse-gases-level3-products.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/Randbee/C3SBook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Randbee/C3SBook/issues/new?title=Issue%20on%20page%20%2Fsubmodules/c3s-training-submodule-sat-obs-atmos-comp/greenhouse-gases-level3-products.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/submodules/c3s-training-submodule-sat-obs-atmos-comp/greenhouse-gases-level3-products.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>How to access, read and use satellite XCO2 and XCH4 Level 3 data products</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">How to access, read and use satellite XCO2 and XCH4 Level 3 data products</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-read-and-process-the-satellite-data-with-python">How to read and process the satellite data with Python</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-access-satellite-data-products">How to access satellite data products</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-access-via-cds-api-cdsapi">Data access via CDS API (cdsapi)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-select-and-download-a-specific-data-product">How to select and download a specific data product</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#other-preparatory-work-including-data-directory">Other preparatory work including data directory</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-default-plot-style-parameters">Setting default plot style parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#product-selection-xco2-or-xch4-level-3-obs4mips-product">Product selection: XCO2 or XCH4 Level 3 OBS4MIPS product</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#product-specific-settings">Product specific settings</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-download-via-cdsapi">Data download via cdsapi</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#check-if-the-desired-data-are-available">Check if the desired data are available</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-the-obs4mips-file">Reading the OBS4MIPS file</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#application-1-investigating-time-series-for-selected-latitude-band">Application 1: Investigating time series for selected latitude band</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-time-series">Plotting time series</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#application-2-investigating-spatial-variations-and-coverage">Application 2: Investigating spatial variations and coverage</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p>Michael Buchwitz, 20-Nov-2024</p>
<section class="tex2jax_ignore mathjax_ignore" id="how-to-access-read-and-use-satellite-xco2-and-xch4-level-3-data-products">
<h1>How to access, read and use satellite XCO2 and XCH4 Level 3 data products<a class="headerlink" href="#how-to-access-read-and-use-satellite-xco2-and-xch4-level-3-data-products" title="Link to this heading">#</a></h1>
<p>This is a Jupyter Notebook (JN) illustrating how to access, read and use Greenhouse Gas (GHG) atmospheric carbon dioxide (CO2) and methane (CH4) data products as generated in the framework of the Copernicus Climate Change Service (C3S).</p>
<p>The C3S GHG data products used here are retrieved from satellite radiance measurement using dedicated retrieval algorithms. Most of these algorithms have been developed in the past within the Climate Change Initiative (CCI) of the European Space Agency (ESA). These algorithms are now used to operationally generate the corresponding data products within the European Union (EU) C3S project. The data products are freely available for all interested users from the Copernicus Climate Data Store (CDS,
<a class="reference external" href="https://cds.climate.copernicus.eu/">https://cds.climate.copernicus.eu/</a>).</p>
<p>Several satellite-derived Essential Climate Variable (ECV) atmospheric data products are generated for GHGs (CO2 and CH4), aerosols and ozone. This JN focusses on GHG Level 3 (L3) products. The other products are covered by separate JNs. The GHG L3 products are available at a spatial resolution of 5 deg latitude times 5 deg longitude and monthly time resolution. In contrast, Level 2 (L2) products contain retrieved parameters for individual satellite ground pixels (footprints). How to use L2 GHG products is described in a separate JN.</p>
<p>The GHG L3 products contain column-averaged dry-air mole fractions of CO2 and CH4, denoted XCO2 (in ppm) and XCH4 (in ppb). They are derived from SCIAMACHY/ENVISAT, GOSAT, GOSAT-2 and OCO-2. The relevant peer-reviewed publication describing the algorithm and an earlier version of the data products is Reuter et al., 2020 (<a class="reference external" href="https://amt.copernicus.org/articles/13/789/2020/">https://amt.copernicus.org/articles/13/789/2020/</a>). The relevant technical documentation and further information is available on the CDS website (<a class="reference external" href="https://cds.climate.copernicus.eu/">https://cds.climate.copernicus.eu/</a>).</p>
<p>The atmospheric concentration of both gases varies in time and in space. This JN focusses on two use cases.</p>
<p>The first use case is related to temporal variations. Temporal atmospheric concentration variations depend, for example, on latitude. Seasonal variations are, for example, different for the northern hemisphere (NH) and the southern hemisphere (SN), whereas the increasing trend is similar for different latitude bands. This can be investigated by generating and plotting time series for latitude bands. How this can be done is shown in this JN.</p>
<p>The second use case is related to spatial variations. Here it is shown how spatial maps of GHG concentrations and their uncertainty can be generated. Depending on time (month, season) XCO2 maps show large differences of the CO2 concentration in the two hemispheres, i.e., a significant interhemispheric CO2 gradient. This is also observed for XCH4. In each hemisphere the concentration of both gases is quite similar as both gases are long lived and well mixed due to atmospheric transport and diffusion. Nevertheless, strong source regions are sometimes (during certain months) directly visible via locally enhanced concentrations.  This can be seen and investigated by generating monthly XCO2 and XCH4 maps. The monthly maps also show the time dependent spatial coverage of the satellite-derived data products. This is primarily due to the fact that these satellite observations require good solar illumination conditions. The spatial coverage therefore closely follows the sun with better coverage of the summer hemisphere compared to the winter hemisphere. Data gaps are also due to clouds (all data are filtered to avoid cloud contamination), water surfaces (oceans and lakes, etc., are poor reflectors of solar radiation in the short-wave infra-red spectral range except for sun-glint observing conditions) and for other reasons. How these spatial maps can be generated is shown in this JN.</p>
<p>The L3 XCO2 data product used here has product identifier (ID) XCO2_OBS4MIPS and the L3 XCH4 product ID is XCH4_OBS4MIPS. The code has been tested using version 4.5 of these products, which covers the period from beginning of 2003 to end of 2022.</p>
<section id="how-to-read-and-process-the-satellite-data-with-python">
<h2>How to read and process the satellite data with Python<a class="headerlink" href="#how-to-read-and-process-the-satellite-data-with-python" title="Link to this heading">#</a></h2>
<p>In the following, Phython 3 code is provided to read and process the satellite data.</p>
<p>It is assumed that Python and Jupyter Notebook (JN) is installed on your computer, e.g., using the Anaconda distribution (<a class="reference external" href="https://www.anaconda.com/products/distribution">https://www.anaconda.com/products/distribution</a>).</p>
</section>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Link to this heading">#</a></h2>
<p>First we have to import some modules:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import libraries needed for the Jupyter notebook</span>

<span class="c1"># Note that lines starting with &quot;#&quot; are comment lines</span>

<span class="c1"># Libraries for working with data, especially multidimensional arrays</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>

<span class="c1"># Library to work with zip-archives, operating system (OS) functions and pattern expansion</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># Libraries for plotting and visualising data</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mplt</span>
<span class="c1">#import matplotlib.dates as md</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="c1"># Libraries for style parameters</span>
<span class="kn">from</span> <span class="nn">pylab</span> <span class="kn">import</span> <span class="n">rcParams</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="c1"># Disable warnings for data download via API</span>
<span class="kn">import</span> <span class="nn">urllib3</span>
<span class="n">urllib3</span><span class="o">.</span><span class="n">disable_warnings</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* ... finished importing modules&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* ... finished importing modules
</pre></div>
</div>
</div>
</div>
</section>
<section id="how-to-access-satellite-data-products">
<h2>How to access satellite data products<a class="headerlink" href="#how-to-access-satellite-data-products" title="Link to this heading">#</a></h2>
<p>The C3S GHG data products and their documentation are available from the CDS website.</p>
<p>CO2 data and documents are available from <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/satellite-carbon-dioxide?tab=overview">https://cds.climate.copernicus.eu/datasets/satellite-carbon-dioxide?tab=overview</a>.</p>
<p>CH4 data and documents are available from <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/satellite-methane?tab=overview">https://cds.climate.copernicus.eu/datasets/satellite-methane?tab=overview</a>.</p>
<p>Each satellite-derived CO2 or CH4 data product as generated in C3S and made available via the CDS has a unique product ID. The product IDs of the Level 3 products used here are XCO2_OBS4MIPS and XCH4_OBS4MIPS. Each products consists of a single NetCDF file in Obs4MIPs format (<a class="reference external" href="https://esgf-node.llnl.gov/projects/obs4mips/">https://esgf-node.llnl.gov/projects/obs4mips/</a>). These products have been generated by merging data products from different satellite sensors. On the CDS website these products can be selected and downloaded by selecting “MERGED and OBS4MIPS” for item “Sensor and algorithm” as described in details in the following section.</p>
<section id="data-access-via-cds-api-cdsapi">
<h3>Data access via CDS API (cdsapi)<a class="headerlink" href="#data-access-via-cds-api-cdsapi" title="Link to this heading">#</a></h3>
<p>The C3S data products can be downloaded them from the Copernicus Climate Data Store (CDS) using the cdsapi, i.e., the CDS Application Programming Interface (API). How to use the cdsapi is described here:</p>
<p>First, goto the CDS website:
<a class="reference external" href="https://cds.climate.copernicus.eu/">https://cds.climate.copernicus.eu/</a></p>
<p>Login (if not done already, please register using “Create new account”).</p>
<p>To use the cdsapi you need to set two variables, URL and KEY:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specify the CDS path for data access and your personal access key:</span>

<span class="n">URL</span><span class="o">=</span><span class="s1">&#39;https://cds.climate.copernicus.eu/api&#39;</span>
<span class="c1"># Replace the string by your personal key (see below):</span>
<span class="n">KEY</span><span class="o">=</span><span class="s1">&#39;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#39;</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* URL: &#39;</span><span class="p">,</span> <span class="n">URL</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* KEY: &#39;</span><span class="p">,</span> <span class="n">KEY</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* URL:  https://cds.climate.copernicus.eu/api
* KEY:  a8764fcc-d86b-4791-81c7-66c40885a25a
</pre></div>
</div>
</div>
</div>
<p>KEY ‘XXX…XXX’ is only a placeholder and needs to be replaced by your personal KEY.</p>
<p>To get your KEY, please login to the CDS website (see above) and then visit <a class="reference external" href="https://cds.climate.copernicus.eu/how-to-api">https://cds.climate.copernicus.eu/how-to-api</a>.</p>
<p>Your personal KEY will appear on the screen.
Use that KEY to replace the placeholder key ‘XXX…XXX’ shown above.</p>
</section>
<section id="how-to-select-and-download-a-specific-data-product">
<h3>How to select and download a specific data product<a class="headerlink" href="#how-to-select-and-download-a-specific-data-product" title="Link to this heading">#</a></h3>
<p>In the following we explain how to obtain XCO2_OBS4MIPS v4.5 data product files.</p>
<p>The same method can be used to get the corresponding methane product XCH4_OBS4MIPS or another version of these Level 3 products.</p>
<p>Visit the CDS website <a class="reference external" href="https://cds.climate.copernicus.eu/">https://cds.climate.copernicus.eu/</a> and search for “CO2” in the search field.</p>
<p>Then click on:</p>
<ul class="simple">
<li><p>Carbon dioxide data from 2002 to present derived from satellite observations</p></li>
</ul>
<p>Click on the “Download” tab.</p>
<p>Select the desired product by choosing in the “Download” tab:</p>
<ul class="simple">
<li><p>Processing level: Level 3</p></li>
<li><p>Variable: Column-average dry-air mole fraction of atmospheric Carbon Dioxide (XCO2) and related variables</p></li>
<li><p>Sensor and algorithm: MERGED and OBS4MIPS</p></li>
<li><p>Version: 4.5</p></li>
</ul>
<p>Then click on:</p>
<ul class="simple">
<li><p>Show API request code</p></li>
</ul>
<p>The following Python code will appear on the screen:</p>
<p>import cdsapi</p>
<p>dataset = “satellite-carbon-dioxide”</p>
<p>request = {</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&quot;processing_level&quot;: [&quot;level_3&quot;],

&quot;variable&quot;: &quot;xco2&quot;,

&quot;sensor_and_algorithm&quot;: &quot;merged_obs4mips&quot;,

&quot;version&quot;: [&quot;4_5&quot;]
</pre></div>
</div>
<p>}</p>
<p>client = cdsapi.Client()</p>
<p>client.retrieve(dataset, request).download()</p>
<p>This code is used below to access the data.</p>
</section>
</section>
<section id="other-preparatory-work-including-data-directory">
<h2>Other preparatory work including data directory<a class="headerlink" href="#other-preparatory-work-including-data-directory" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specify local data directory for the downloads:</span>

<span class="c1">#data_directory = &quot;./data_dir_tmp/&quot;   # Test only</span>
<span class="n">data_directory</span> <span class="o">=</span> <span class="s2">&quot;data_dir&quot;</span>

<span class="n">DATADIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">data_directory</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">DATADIR</span><span class="p">):</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Generating: &#39;</span><span class="p">,</span> <span class="n">DATADIR</span><span class="p">)</span> 
   <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">DATADIR</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* sub-directory exists: &#39;</span><span class="p">,</span> <span class="n">DATADIR</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* Generating:  data_dir
</pre></div>
</div>
</div>
</div>
</section>
<section id="setting-default-plot-style-parameters">
<h2>Setting default plot style parameters<a class="headerlink" href="#setting-default-plot-style-parameters" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The following style parameters will be used for all plots in this use case.</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">350</span>
<span class="c1">#rcParams[&#39;font.family&#39;] = &#39;serif&#39;</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Arial&#39;</span>
<span class="c1">#rcParams[&#39;font.serif&#39;] = mplt.rcParamsDefault[&#39;font.serif&#39;]</span>
<span class="c1">#rcParams[&#39;mathtext.rm&#39;] = &#39;serif:light&#39;</span>
<span class="c1">#rcParams[&#39;mathtext.it&#39;] = &#39;serif:italic&#39;</span>
<span class="c1">#rcParams[&#39;mathtext.bf&#39;] = &#39;serif:bold&#39;</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;mathtext.default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;regular&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>          <span class="c1"># controls default text sizes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">titlesize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>     <span class="c1"># fontsize of the axes title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>     <span class="c1"># fontsize of the x and y labelsize</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;xtick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>    <span class="c1"># fontsize of the tick labels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;ytick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>    <span class="c1"># fontsize of the tick labels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;legend&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>    <span class="c1"># fontsize of the legend</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">titlesize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>   <span class="c1"># fontsize of the figure title</span>

<span class="n">projection</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
<span class="n">mplt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;xtick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">mplt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;ytick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* ... finished setting default plot style parameters&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* ... finished setting default plot style parameters
</pre></div>
</div>
</div>
</div>
</section>
<section id="product-selection-xco2-or-xch4-level-3-obs4mips-product">
<h2>Product selection: XCO2 or XCH4 Level 3 OBS4MIPS product<a class="headerlink" href="#product-selection-xco2-or-xch4-level-3-obs4mips-product" title="Link to this heading">#</a></h2>
<p>Select the desired product by activating either the line with XCO2 or the line with XCH4. Here we have selected XCH4:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select one main product (by commenting in/out):</span>
<span class="c1">#product_name = &#39;XCO2&#39;</span>
<span class="n">product_name</span> <span class="o">=</span> <span class="s1">&#39;XCH4&#39;</span> 

<span class="n">product_id</span> <span class="o">=</span> <span class="n">product_name</span><span class="o">+</span><span class="s1">&#39;_OBS4MIPS&#39;</span>

<span class="c1">#Select product version (by commenting in / out):</span>
<span class="c1">#product_version = &#39;v4.4&#39;; product_version_str2 = &#39;4_4&#39;; product_period = &#39;200301_202112&#39;</span>
<span class="n">product_version</span> <span class="o">=</span> <span class="s1">&#39;v4.5&#39;</span><span class="p">;</span> <span class="n">product_version_str2</span> <span class="o">=</span> <span class="s1">&#39;4_5&#39;</span><span class="p">;</span> <span class="n">product_period</span> <span class="o">=</span> <span class="s1">&#39;200301_202212&#39;</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Selected Level 3 product:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* product_id: &#39;</span><span class="p">,</span> <span class="n">product_id</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* product_version: &#39;</span><span class="p">,</span> <span class="n">product_version</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* Selected Level 3 product:
* product_id:  XCH4_OBS4MIPS
* product_version:  v4.5
</pre></div>
</div>
</div>
</div>
</section>
<section id="product-specific-settings">
<h2>Product specific settings<a class="headerlink" href="#product-specific-settings" title="Link to this heading">#</a></h2>
<p>Here some variables are set depending on the selected product:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define some product specific variables:</span>
<span class="k">if</span> <span class="n">product_name</span> <span class="o">==</span> <span class="s1">&#39;XCO2&#39;</span><span class="p">:</span>
   <span class="n">wanted_variable</span>      <span class="o">=</span> <span class="s1">&#39;xco2&#39;</span>        <span class="c1"># main variable</span>
   <span class="n">wanted_variable_unc</span>  <span class="o">=</span> <span class="s1">&#39;xco2_stderr&#39;</span> <span class="c1"># uncertainty of main variable</span>
   <span class="n">unit_conv</span>         <span class="o">=</span> <span class="mf">1e6</span>              <span class="c1"># unit conversion factor from mole/mole to ppm</span>
   <span class="n">unit</span>              <span class="o">=</span> <span class="s1">&#39;[ppm]&#39;</span>          <span class="c1"># desired unit</span>
<span class="k">if</span> <span class="n">product_name</span> <span class="o">==</span> <span class="s1">&#39;XCH4&#39;</span><span class="p">:</span>              
   <span class="n">wanted_variable</span>      <span class="o">=</span> <span class="s1">&#39;xch4&#39;</span>        <span class="c1"># main variable</span>
   <span class="n">wanted_variable_unc</span>  <span class="o">=</span> <span class="s1">&#39;xch4_stderr&#39;</span> <span class="c1"># uncertainty of main variable</span>
   <span class="n">unit_conv</span>         <span class="o">=</span> <span class="mf">1e9</span>              <span class="c1"># unit conversion factor from mole/mole to ppb</span>
   <span class="n">unit</span>              <span class="o">=</span> <span class="s1">&#39;[ppb]&#39;</span>          <span class="c1"># desired unit</span>
    
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* wanted_variable: &#39;</span><span class="p">,</span> <span class="n">wanted_variable</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* wanted_variable:  xch4
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-download-via-cdsapi">
<h2>Data download via cdsapi<a class="headerlink" href="#data-download-via-cdsapi" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Have the data already been downloaded (please select by commenting in/out)?:</span>
<span class="n">product_already_downloaded</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span>     <span class="c1"># Default</span>
<span class="c1">#product_already_downloaded = &#39;yes&#39;   # Use this if data already downloaded</span>

<span class="k">if</span> <span class="n">product_already_downloaded</span> <span class="o">==</span> <span class="s1">&#39;no&#39;</span><span class="p">:</span>

   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* downloading product ...&#39;</span><span class="p">)</span>

   <span class="c1"># Code obtained via &quot;Show API request code&quot; (see above):</span>

   <span class="k">if</span> <span class="n">product_name</span> <span class="o">==</span> <span class="s1">&#39;XCO2&#39;</span><span class="p">:</span>
      <span class="c1"># Copy code obtained from &quot;Show API request code&quot;:</span>
      <span class="kn">import</span> <span class="nn">cdsapi</span>
      <span class="n">dataset</span> <span class="o">=</span> <span class="s2">&quot;satellite-carbon-dioxide&quot;</span>
      <span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
         <span class="s2">&quot;processing_level&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;level_3&quot;</span><span class="p">],</span>
          <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;xco2&quot;</span><span class="p">,</span>
          <span class="s2">&quot;sensor_and_algorithm&quot;</span><span class="p">:</span> <span class="s2">&quot;merged_obs4mips&quot;</span><span class="p">,</span>
          <span class="c1">#&quot;version&quot;: [&quot;4_5&quot;]</span>
          <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">product_version_str2</span><span class="p">]</span>
      <span class="p">}</span>

   <span class="k">if</span> <span class="n">product_name</span> <span class="o">==</span> <span class="s1">&#39;XCH4&#39;</span><span class="p">:</span>
      <span class="c1"># Copy code obtained from &quot;Show API request code&quot;:</span>
      <span class="kn">import</span> <span class="nn">cdsapi</span>
      <span class="n">dataset</span> <span class="o">=</span> <span class="s2">&quot;satellite-methane&quot;</span>
      <span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
         <span class="s2">&quot;processing_level&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;level_3&quot;</span><span class="p">],</span>
          <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;xch4&quot;</span><span class="p">,</span>
          <span class="s2">&quot;sensor_and_algorithm&quot;</span><span class="p">:</span> <span class="s2">&quot;merged_obs4mips&quot;</span><span class="p">,</span>
          <span class="c1">#&quot;version&quot;: [&quot;4_5&quot;]</span>
          <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">product_version_str2</span><span class="p">]</span>
      <span class="p">}</span>

   <span class="n">client</span> <span class="o">=</span> <span class="n">cdsapi</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">URL</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">KEY</span><span class="p">)</span>
   <span class="c1"># Generates download.zip file in current directory:</span>
   <span class="n">client</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;download.zip&#39;</span><span class="p">)</span>
   
   <span class="c1"># Unzip:</span>
   <span class="n">path_to_zip_file</span>        <span class="o">=</span> <span class="s1">&#39;download.zip&#39;</span>
   <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">path_to_zip_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
    <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">DATADIR</span><span class="p">)</span>
    
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* The following has been selected: product_already_downloaded: &#39;</span><span class="p">,</span> <span class="n">product_already_downloaded</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Therefore, no data download via cdsapi&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* downloading product ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-20 13:27:41,326 WARNING [2024-11-19T00:00:00] Issue with underlaying infrastructure is now solved. System should gradually recover. Please check updated status [here](https://status.ecmwf.int/)
2024-11-20 13:27:41,328 INFO [2024-09-28T00:00:00] **Welcome to the New Climate Data Store (CDS)!** This new system is in its early days of full operations and still undergoing enhancements and fine tuning. Some disruptions are to be expected. Your 
[feedback](https://jira.ecmwf.int/plugins/servlet/desk/portal/1/create/202) is key to improve the user experience on the new CDS for the benefit of everyone. Thank you.
2024-11-20 13:27:41,332 INFO [2024-09-26T00:00:00] Watch our [Forum](https://forum.ecmwf.int/) for Announcements, news and other discussed topics.
2024-11-20 13:27:41,334 INFO [2024-09-16T00:00:00] Remember that you need to have an ECMWF account to use the new CDS. **Your old CDS credentials will not work in new CDS!**
2024-11-20 13:27:41,336 WARNING [2024-06-16T00:00:00] CDS API syntax is changed and some keys or parameter names may have also changed. To avoid requests failing, please use the &quot;Show API request code&quot; tool on the dataset Download Form to check you are using the correct syntax for your API request.
2024-11-20 13:27:43,073 INFO Request ID is cbe383ad-b20e-4277-b4b5-ffd81a5a2945
2024-11-20 13:27:43,145 INFO status has been updated to accepted
2024-11-20 13:27:47,204 INFO status has been updated to running
2024-11-20 13:27:49,606 INFO status has been updated to successful
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "", "version_major": 2, "version_minor": 0}</script></div>
</div>
</section>
<section id="check-if-the-desired-data-are-available">
<h2>Check if the desired data are available<a class="headerlink" href="#check-if-the-desired-data-are-available" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># If the above cell has been executed for both products, then following two files should be located in sub-directory data_dir:</span>
<span class="c1"># 200301_202212-C3S-L3_XCO2-GHG_PRODUCTS-MERGED-MERGED-OBS4MIPS-MERGED-v4.5.nc</span>
<span class="c1"># 200301_202212-C3S-L3_XCH4-GHG_PRODUCTS-MERGED-MERGED-OBS4MIPS-MERGED-v4.5.nc</span>

<span class="c1"># Check if the desired file exists:</span>
<span class="n">wanted_file_OK</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span>
<span class="n">wanted_file</span> <span class="o">=</span> <span class="n">product_period</span><span class="o">+</span><span class="s1">&#39;-C3S-L3_&#39;</span><span class="o">+</span><span class="n">product_name</span><span class="o">+</span><span class="s1">&#39;-GHG_PRODUCTS-MERGED-MERGED-OBS4MIPS-MERGED-&#39;</span><span class="o">+</span><span class="n">product_version</span><span class="o">+</span><span class="s1">&#39;.nc&#39;</span>
<span class="n">wanted_path_file</span> <span class="o">=</span> <span class="n">DATADIR</span><span class="o">/</span><span class="n">wanted_file</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* wanted product file: &#39;</span><span class="p">,</span> <span class="n">wanted_path_file</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">wanted_path_file</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* ... file exists&#39;</span><span class="p">)</span>
   <span class="n">wanted_file_OK</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span>
<span class="k">else</span><span class="p">:</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* ERROR: File does not exist !?&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* wanted product file:  data_dir\200301_202212-C3S-L3_XCH4-GHG_PRODUCTS-MERGED-MERGED-OBS4MIPS-MERGED-v4.5.nc
* ... file exists
</pre></div>
</div>
</div>
</div>
</section>
<section id="reading-the-obs4mips-file">
<h2>Reading the OBS4MIPS file<a class="headerlink" href="#reading-the-obs4mips-file" title="Link to this heading">#</a></h2>
<p>Open and read the data file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">wanted_file_OK</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* reading: &#39;</span><span class="p">,</span> <span class="n">wanted_path_file</span><span class="p">)</span>
   <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">wanted_path_file</span><span class="p">)</span>                    <span class="c1"># Read data</span>
   <span class="n">product_version_2</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;source_version_number&#39;</span><span class="p">]</span>     <span class="c1"># Get version number</span>
   <span class="n">n_time</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>                                  <span class="c1"># Get number of times = number of months</span>
   <span class="n">gas</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">wanted_variable</span><span class="p">]</span> <span class="o">*</span> <span class="n">unit_conv</span>                     <span class="c1"># conversion to ppm or ppb</span>
   <span class="n">land_fraction</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;land_fraction&quot;</span><span class="p">]</span>                       <span class="c1"># land fraction (0.0 = 0% land (=100% water); 1.0 = 100% land)</span>
<span class="k">else</span><span class="p">:</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* ERROR: File does not exist !?&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* reading:  data_dir\200301_202212-C3S-L3_XCH4-GHG_PRODUCTS-MERGED-MERGED-OBS4MIPS-MERGED-v4.5.nc
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="application-1-investigating-time-series-for-selected-latitude-band">
<h1>Application 1: Investigating time series for selected latitude band<a class="headerlink" href="#application-1-investigating-time-series-for-selected-latitude-band" title="Link to this heading">#</a></h1>
<p>Here the user can select a latitude band by specification of lat_min and lat_max.</p>
<p>For this latitude band the data covering the entire time series are generated and plotted.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">wanted_file_OK</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* generating time series for latitude band ...&#39;</span><span class="p">)</span>
   <span class="n">lat_min</span> <span class="o">=</span> <span class="mf">30.0</span><span class="p">;</span> <span class="n">lat_max</span> <span class="o">=</span> <span class="s1">&#39;60.0&#39;</span><span class="p">;</span> <span class="n">land_fraction_min</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">;</span> <span class="n">lat_band_str</span> <span class="o">=</span> <span class="s1">&#39;Northern Mid-latitudes (30N - 60N), land&#39;</span> <span class="c1"># Define latitude band</span>
   <span class="c1">#gas_lat_band = gas.sel(lat=slice(lat_min,lat_max))                            # Get data for latitude band</span>
   <span class="n">gas_lat_band</span>           <span class="o">=</span> <span class="n">gas</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">))</span>                  <span class="c1"># Get data for latitude band</span>
   <span class="n">land_fraction_lat_band</span> <span class="o">=</span> <span class="n">land_fraction</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">))</span>        <span class="c1"># Get land fractions for latitude band</span>
   <span class="p">(</span><span class="n">idx_not_land</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">land_fraction_lat_band</span><span class="o">.</span><span class="n">values</span> <span class="o">&lt;</span> <span class="n">land_fraction_min</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span> <span class="c1"># Get indices of non-land grid cells</span>
   <span class="n">s_fyear</span>  <span class="o">=</span> <span class="p">[]</span>   <span class="c1"># list for fractional year</span>
   <span class="n">s_year</span>   <span class="o">=</span> <span class="p">[]</span>   <span class="c1"># year</span>
   <span class="n">s_month</span>  <span class="o">=</span> <span class="p">[]</span>   <span class="c1"># month</span>
   <span class="n">s_gas</span>    <span class="o">=</span> <span class="p">[]</span>   <span class="c1"># mean value of gas (i.e., XCO2 or XCH4) in latitude band</span>
   <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_time</span><span class="p">):</span>                           <span class="c1"># loop over all months</span>
      <span class="n">act_time</span>     <span class="o">=</span> <span class="n">gas</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>              <span class="c1"># get time</span>
      <span class="n">act_time_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">act_time</span><span class="p">)</span>                    <span class="c1"># convert time to string    </span>
      <span class="n">act_year</span>     <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">act_time_str</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>           <span class="c1"># get year</span>
      <span class="n">act_month</span>    <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">act_time_str</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">])</span>           <span class="c1"># get month</span>
      <span class="n">act_fyear</span>    <span class="o">=</span> <span class="n">act_year</span> <span class="o">+</span> <span class="p">(</span><span class="n">act_month</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="mf">12.0</span>  <span class="c1"># get fractional year</span>
      <span class="n">tmp_gas</span>      <span class="o">=</span> <span class="n">gas_lat_band</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">ii</span><span class="p">)</span>       <span class="c1"># get all gas values in latitude band for act. month</span>
      <span class="n">tmp_gas</span><span class="p">[(</span><span class="n">idx_not_land</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>                <span class="c1"># Set non-land cells to NaN</span>
      <span class="n">act_gas</span>      <span class="o">=</span> <span class="n">tmp_gas</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span> <span class="c1"># get gas mean value for act. month</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">act_gas</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">):</span>
         <span class="c1">#print(&#39;* ii act_time act_gas: &#39;, ii, act_time, act_gas)</span>
         <span class="n">s_fyear</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_fyear</span><span class="p">)</span>         <span class="c1"># fractional year</span>
         <span class="n">s_year</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_year</span><span class="p">)</span>
         <span class="n">s_month</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_month</span><span class="p">)</span>
         <span class="n">s_gas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_gas</span><span class="p">)</span>
      <span class="c1">#else:</span>
      <span class="c1">#   print(&#39;* Warning: gas value is NaN for year month: &#39;, act_year, act_month)</span>
      <span class="c1">#   if ((act_year == 2015) &amp; (act_month == 1)):</span>
      <span class="c1">#      print(&#39;* Note: No satellite data available for January 2015&#39;)</span>
   <span class="n">s_fyear</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">s_fyear</span><span class="p">)</span>
   <span class="n">s_year</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">s_year</span><span class="p">)</span>
   <span class="n">s_month</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">s_month</span><span class="p">)</span>
   <span class="n">s_gas</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">s_gas</span><span class="p">)</span>                      <span class="c1"># land fraction (0.0 = 0% land (=100% water); 1.0 = 100% land)</span>
<span class="k">else</span><span class="p">:</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* ERROR: File does not exist !?&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* generating time series for latitude band ...
</pre></div>
</div>
</div>
</div>
<section id="plotting-time-series">
<h2>Plotting time series<a class="headerlink" href="#plotting-time-series" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">wanted_file_OK</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
   <span class="c1"># Plot time series:</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* plotting time series ...&#39;</span><span class="p">)</span>
   <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>                             <span class="c1"># select seaborn for plot style </span>
   <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
   <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>     <span class="c1"># page size</span>
   <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">]</span>        <span class="c1"># position (left,bottom,width,height) in page coord</span>
   <span class="n">ax</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
   <span class="n">ax</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">useOffset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># prevent scientific notation axis numbering</span>
   <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">s_year</span><span class="p">)</span>                 <span class="c1"># x axis range and annotation</span>
   <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">s_year</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
   <span class="n">xxx_int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
   <span class="n">xxx_ano</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xxx_int</span><span class="p">]</span>
   <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xxx_int</span><span class="p">)</span>
   <span class="c1">#ax.set_xticklabels(xxx_ano, fontsize=12)</span>
   <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">xxx_ano</span><span class="p">)</span>
   <span class="n">rmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">s_gas</span><span class="p">)</span><span class="o">*</span><span class="mf">0.99</span>             <span class="c1"># y axis range</span>
   <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">s_gas</span><span class="p">)</span><span class="o">*</span><span class="mf">1.01</span>
   <span class="n">title</span> <span class="o">=</span> <span class="n">product_id</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">product_version_2</span>
   <span class="n">xtitle</span> <span class="o">=</span> <span class="s1">&#39;Time [year]&#39;</span>
   <span class="n">ytitle</span> <span class="o">=</span> <span class="n">product_name</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">unit</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">s_fyear</span><span class="p">,</span> <span class="n">s_gas</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s_fyear</span><span class="p">,</span> <span class="n">s_gas</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lat_band_str</span><span class="p">)</span>
   <span class="n">ymin</span> <span class="o">=</span> <span class="n">rmin</span><span class="p">;</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">rmax</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">])</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xtitle</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ytitle</span><span class="p">)</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">)</span>
   <span class="n">plot_type</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span>
   <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;png&#39;</span><span class="p">:</span>
      <span class="n">o_file_plot</span> <span class="o">=</span> <span class="n">product_id</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">product_version</span><span class="o">+</span><span class="s1">&#39;_timeseries.png&#39;</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* generating: &#39;</span><span class="p">,</span> <span class="n">o_file_plot</span><span class="p">)</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">o_file_plot</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* ERROR: File does not exist !?&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* plotting time series ...
* generating:  XCH4_OBS4MIPS_v4.5_timeseries.png
</pre></div>
</div>
<img alt="../../_images/31dc6f11b79692f35d1469e3312599a95e59bf45cef5c4f5e333e2e8e47edd3d.png" src="../../_images/31dc6f11b79692f35d1469e3312599a95e59bf45cef5c4f5e333e2e8e47edd3d.png" />
</div>
</div>
<p>What does this time series tells us?: As can be seen, XCH4 has a strong seasonal cycle with a maximum in the second half of each year over northern hemispheric mid-latitudes. This is mainly due to natural sources such as wetlands, where CH4 emissions are largest when temperatures are high. As can also be seen, XCH4 was (apart from seasonal fluctuations) relatively constant until about 2006. Since 2007 methane is increasing (increasing again as methane was also increasing for several decades until the late 1990th). Additional information on these satellite-derived XCH4 and XCO2 time series can be found in the Copernicus press release from January 2023, where an earlier version of this data sets have been used: “Copernicus: 2022 was a year of climate extremes, with record high temperatures and rising concentrations of greenhouse gases”, see <a class="reference external" href="https://climate.copernicus.eu/copernicus-2022-was-year-climate-extremes-record-high-temperatures-and-rising-concentrations">https://climate.copernicus.eu/copernicus-2022-was-year-climate-extremes-record-high-temperatures-and-rising-concentrations</a>. Please have to look at that website to get additional information about the evolution of atmospheric CO2 and XCH using these satellite observations including links to relevant scientific publications.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="application-2-investigating-spatial-variations-and-coverage">
<h1>Application 2: Investigating spatial variations and coverage<a class="headerlink" href="#application-2-investigating-spatial-variations-and-coverage" title="Link to this heading">#</a></h1>
<p>Here the user can chose time (year and month) and spatial domain to generate plots of the spatial distribution of the selected GHG.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">wanted_file_OK</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* plotting map ...&#39;</span><span class="p">)</span>
   
   <span class="c1"># Select year and month:</span>
   <span class="n">wanted_year</span>  <span class="o">=</span> <span class="s1">&#39;2021&#39;</span>
   <span class="n">wanted_month</span> <span class="o">=</span> <span class="s1">&#39;09&#39;</span>
   
   <span class="c1"># Get (only) data for wanted month</span>
   <span class="n">wanted_time</span> <span class="o">=</span> <span class="n">wanted_year</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">wanted_month</span>
   <span class="n">da</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">wanted_time</span><span class="p">)</span>
   <span class="n">n_time_da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
   <span class="n">plot_map_OK</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span>
   <span class="c1">#print(&#39;* n_time_da (should be 1 (= 1 month) !?): &#39;, n_time_da)</span>
   <span class="k">if</span> <span class="n">n_time_da</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* ERROR: n_time_da != 1: &#39;</span><span class="p">,</span> <span class="n">n_time_da</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="c1"># Get lat, lon, data for plot</span>
      <span class="n">coord_lat</span>  <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>          <span class="c1"># Get latitudes</span>
      <span class="n">coord_lon</span>  <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>          <span class="c1"># Get longitudes</span>
      <span class="n">data</span> <span class="o">=</span> <span class="n">da</span><span class="p">[</span><span class="n">wanted_variable</span><span class="p">]</span>                    <span class="c1"># Get xco2 or xch4</span>
      <span class="n">act_time</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>                <span class="c1"># Get time</span>
      <span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">act_time</span><span class="p">))</span>
      <span class="n">act_year</span>  <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">)</span>
      <span class="n">act_month</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">)</span>
      <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>                      <span class="c1"># Remove time dimension</span>
      <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">*</span> <span class="n">unit_conv</span>                       <span class="c1"># conversion to ppm or ppb</span>
      <span class="n">plt_data</span>     <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span>                    <span class="c1"># Get data values to be plotted</span>
      <span class="n">plt_data_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>         <span class="c1"># Get minimum data value for plot</span>
      <span class="n">plt_data_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>         <span class="c1"># Get maximum data value for plot</span>
      <span class="n">plt_data_mean</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">plt_data</span><span class="p">)</span>      <span class="c1"># Compute mean value</span>
      <span class="n">plt_data_std</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">plt_data</span><span class="p">)</span>       <span class="c1"># Compute standard deviation</span>
      <span class="n">plt_data_mean_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plt_data_mean</span><span class="p">)</span>
      <span class="n">plt_data_std_str</span>  <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plt_data_std</span><span class="p">)</span>
      <span class="n">plt_data_str</span>      <span class="o">=</span> <span class="s1">&#39;mean+/-std: &#39;</span><span class="o">+</span><span class="n">plt_data_mean_str</span><span class="o">+</span><span class="s1">&#39;+/-&#39;</span><span class="o">+</span><span class="n">plt_data_std_str</span>
      <span class="c1"># ------------------</span>
      <span class="n">plt_lat</span>      <span class="o">=</span> <span class="n">coord_lat</span>    
      <span class="n">plt_lon</span>      <span class="o">=</span> <span class="n">coord_lon</span>    
      <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>                                     <span class="c1"># use seaborn plot style</span>
      <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
      <span class="n">latlon_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">]</span>          <span class="c1"># Set lat/lon range for plot</span>
      <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>                               <span class="c1"># Figure size</span>
      <span class="c1"># -------</span>
      <span class="n">n_ticks</span> <span class="o">=</span> <span class="mi">5</span>                                   <span class="c1"># Set color bar parameters</span>
      <span class="n">vmin</span>  <span class="o">=</span> <span class="n">plt_data_min</span>
      <span class="n">vmax</span>  <span class="o">=</span> <span class="n">plt_data_max</span>
      <span class="n">vinc</span>  <span class="o">=</span> <span class="p">(</span><span class="n">vmax</span><span class="o">-</span><span class="n">vmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_ticks</span>
      <span class="n">vinc</span>  <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">vinc</span><span class="p">))</span> <span class="c1"># next largest int</span>
      <span class="n">vmax</span>  <span class="o">=</span> <span class="n">vmin</span> <span class="o">+</span> <span class="n">n_ticks</span> <span class="o">*</span> <span class="n">vinc</span>
      <span class="c1"># -------</span>
      <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span> <span class="c1"># page size</span>
      <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">,</span> <span class="mf">0.84</span><span class="p">,</span> <span class="mf">0.72</span><span class="p">]</span> <span class="c1"># position (left,bottom,width,height) in page coordinates</span>
      <span class="n">ax</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">proj</span><span class="p">)</span>
      <span class="n">cs</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">plt_lon</span><span class="p">,</span> <span class="n">plt_lat</span><span class="p">,</span> <span class="n">plt_data</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">proj</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
      <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
      <span class="n">drawmeridians_label</span> <span class="o">=</span> <span class="kc">True</span>
      <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">proj</span><span class="p">,</span> <span class="n">draw_labels</span><span class="o">=</span><span class="n">drawmeridians_label</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
      <span class="n">gl</span><span class="o">.</span><span class="n">top_labels</span>  <span class="o">=</span> <span class="kc">False</span>
      <span class="n">tit</span> <span class="o">=</span> <span class="n">product_id</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">product_version_2</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">wanted_year</span><span class="o">+</span><span class="n">wanted_month</span><span class="o">+</span><span class="s1">&#39;: Variable = &#39;</span><span class="o">+</span><span class="n">wanted_variable</span>
      <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">tit</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
      <span class="c1"># color bar:</span>
      <span class="n">cbar_ax</span>        <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">])</span> <span class="c1"># position</span>
      <span class="n">cbar</span>           <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cbar_ax</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">vinc</span><span class="p">),</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
      <span class="n">cbar_title</span>     <span class="o">=</span> <span class="n">wanted_variable</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">unit</span>
      <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">cbar_title</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># labepad-&gt;y-shift</span>
      <span class="c1"># ----------------------------------------</span>
      <span class="n">plot_map_OK</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span>
      <span class="c1"># ----------------------------------------</span>
      <span class="n">plot_type</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span>
      <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;png&#39;</span><span class="p">:</span>
         <span class="n">o_file_plot</span> <span class="o">=</span> <span class="n">product_id</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">product_version</span><span class="o">+</span><span class="s1">&#39;_map_main.png&#39;</span>
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* generating: &#39;</span><span class="p">,</span> <span class="n">o_file_plot</span><span class="p">)</span>
         <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">o_file_plot</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* plotting map ...
* generating:  XCH4_OBS4MIPS_v4.5_map_main.png
</pre></div>
</div>
<img alt="../../_images/5fbc383d497befd62ee9eed53d61677668369f685def7151ef1c6eb6f1a5bcdb.png" src="../../_images/5fbc383d497befd62ee9eed53d61677668369f685def7151ef1c6eb6f1a5bcdb.png" />
</div>
</div>
<p>As can be seen, the spatial variation is typically small. The largest difference is often the interhemisheric difference, i.e., the concentration difference between the two hemispheres. Nevertheless, strong source regions may be visible via locally enhanced concentrations.</p>
<p>Here a second maps is generated to see the corresponding (1-sigma) uncertainty of the satellite observations, which is contained for each month and each grid cell in the data product.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">wanted_file_OK</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* plotting 2nd map (uncertainty) ...&#39;</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">plot_map_OK</span> <span class="o">!=</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* ERROR: Cannot plot uncertainty map: plot_map_OK: &#39;</span><span class="p">,</span> <span class="n">plot_map_OK</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">data_unc</span> <span class="o">=</span> <span class="n">da</span><span class="p">[</span><span class="n">wanted_variable_unc</span><span class="p">]</span>      <span class="c1"># Get xco2 or xch4 uncertainty</span>
      <span class="n">data_unc</span> <span class="o">=</span> <span class="n">data_unc</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>        <span class="c1"># Remove time dimension</span>
      <span class="n">data_unc</span> <span class="o">=</span> <span class="n">data_unc</span> <span class="o">*</span> <span class="n">unit_conv</span>         <span class="c1"># conversion to ppm or ppb</span>
      <span class="n">plt_data_unc</span>     <span class="o">=</span> <span class="n">data_unc</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># </span>
      <span class="n">plt_data_unc_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data_unc</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
      <span class="n">plt_data_unc_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data_unc</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
      <span class="n">plt_data_unc_mean</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">plt_data_unc</span><span class="p">)</span>
      <span class="n">plt_data_unc_std</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">plt_data_unc</span><span class="p">)</span>
      <span class="n">plt_data_unc_mean_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plt_data_unc_mean</span><span class="p">)</span>
      <span class="n">plt_data_unc_std_str</span>  <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plt_data_unc_std</span><span class="p">)</span>
      <span class="n">plt_data_unc_str</span>      <span class="o">=</span> <span class="s1">&#39;mean+/-std: &#39;</span><span class="o">+</span><span class="n">plt_data_unc_mean_str</span><span class="o">+</span><span class="s1">&#39;+/-&#39;</span><span class="o">+</span><span class="n">plt_data_unc_std_str</span>
      <span class="c1"># ------------------</span>
      <span class="c1"># -------</span>
      <span class="n">n_ticks</span> <span class="o">=</span> <span class="mi">5</span>                            <span class="c1"># Set color bar parameters</span>
      <span class="n">vmin</span>  <span class="o">=</span> <span class="mi">0</span>
      <span class="n">vmax</span>  <span class="o">=</span> <span class="n">plt_data_unc_max</span>
      <span class="n">vinc</span>  <span class="o">=</span> <span class="p">(</span><span class="n">vmax</span><span class="o">-</span><span class="n">vmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_ticks</span>
      <span class="n">vinc</span>  <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">vinc</span><span class="p">))</span>             <span class="c1"># next largest int</span>
      <span class="n">vmax</span>  <span class="o">=</span> <span class="n">vmin</span> <span class="o">+</span> <span class="n">n_ticks</span> <span class="o">*</span> <span class="n">vinc</span>
      <span class="c1"># -------</span>
      <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>                        <span class="c1"># figure size</span>
      <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">,</span> <span class="mf">0.84</span><span class="p">,</span> <span class="mf">0.72</span><span class="p">]</span>         <span class="c1"># position (left,bottom,width,height) in page coordinates</span>
      <span class="n">fig2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>     
      <span class="n">ax2</span>  <span class="o">=</span> <span class="n">fig2</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">proj</span><span class="p">)</span>
      <span class="n">cs</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">plt_lon</span><span class="p">,</span> <span class="n">plt_lat</span><span class="p">,</span> <span class="n">plt_data_unc</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">proj</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
      <span class="n">ax2</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
      <span class="n">gl</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">proj</span><span class="p">,</span> <span class="n">draw_labels</span><span class="o">=</span><span class="n">drawmeridians_label</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
      <span class="n">gl</span><span class="o">.</span><span class="n">top_labels</span>  <span class="o">=</span> <span class="kc">False</span>
      <span class="n">tit</span> <span class="o">=</span> <span class="n">product_id</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">product_version_2</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">wanted_year</span><span class="o">+</span><span class="n">wanted_month</span><span class="o">+</span><span class="s1">&#39;: Variable = &#39;</span><span class="o">+</span><span class="n">wanted_variable_unc</span>
      <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">tit</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
      <span class="c1"># color bar:</span>
      <span class="n">cbar_ax</span>        <span class="o">=</span> <span class="n">fig2</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">])</span> <span class="c1"># position</span>
      <span class="n">cbar</span>           <span class="o">=</span> <span class="n">fig2</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cbar_ax</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">vinc</span><span class="p">),</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
      <span class="n">cbar_title</span>     <span class="o">=</span> <span class="n">wanted_variable_unc</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">unit</span>
      <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">cbar_title</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># labepad-&gt;y-shift</span>
      <span class="c1"># ----------------------------------------</span>
      <span class="n">plot_type</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span>
      <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;png&#39;</span><span class="p">:</span>
         <span class="n">o_file_plot</span> <span class="o">=</span> <span class="n">product_id</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">product_version</span><span class="o">+</span><span class="s1">&#39;_map_unc.png&#39;</span>
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* generating: &#39;</span><span class="p">,</span> <span class="n">o_file_plot</span><span class="p">)</span>
         <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">o_file_plot</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* plotting 2nd map (uncertainty) ...
* generating:  XCH4_OBS4MIPS_v4.5_map_unc.png
</pre></div>
</div>
<img alt="../../_images/c239cc5e2227981b72b12b6b896bbb5a60c0d5bbf2b5d129eb4ed33bfbb8aadc.png" src="../../_images/c239cc5e2227981b72b12b6b896bbb5a60c0d5bbf2b5d129eb4ed33bfbb8aadc.png" />
</div>
</div>
<p>As can be seen, the uncertainty is similar for most regions. For XCH4 the uncertainty is typically on the order of 10 ppb, but may be as large a 20 or 30 ppb for some regions. These are mostly regions with sparse coverage (e.g. due to clouds) and/or a poorly reflecting surface.</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./submodules/c3s-training-submodule-sat-obs-atmos-comp"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="greenhouse-gases-level2-products.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">How to access and use a satellite-derived GHG Level 2 data product using XCO2_EMMA as an example?</p>
      </div>
    </a>
    <a class="right-next"
       href="aerosol-single-sensor-demonstrator.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Exploring gridded data on Aerosol properties available on C3S</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">How to access, read and use satellite XCO2 and XCH4 Level 3 data products</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-read-and-process-the-satellite-data-with-python">How to read and process the satellite data with Python</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-access-satellite-data-products">How to access satellite data products</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-access-via-cds-api-cdsapi">Data access via CDS API (cdsapi)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-select-and-download-a-specific-data-product">How to select and download a specific data product</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#other-preparatory-work-including-data-directory">Other preparatory work including data directory</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-default-plot-style-parameters">Setting default plot style parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#product-selection-xco2-or-xch4-level-3-obs4mips-product">Product selection: XCO2 or XCH4 Level 3 OBS4MIPS product</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#product-specific-settings">Product specific settings</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-download-via-cdsapi">Data download via cdsapi</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#check-if-the-desired-data-are-available">Check if the desired data are available</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-the-obs4mips-file">Reading the OBS4MIPS file</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#application-1-investigating-time-series-for-selected-latitude-band">Application 1: Investigating time series for selected latitude band</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-time-series">Plotting time series</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#application-2-investigating-spatial-variations-and-coverage">Application 2: Investigating spatial variations and coverage</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By the Copernicus Climate Change Service (C3S), entrusted to ECMWF (European Centre for Medium-Range Weather Forecasts)
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>